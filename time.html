<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Mobile Stable Clock Widget</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />

<style>
  :root {
    --bg: #ffffff;
    --fg: #000000;
    --card: #f3f3f3;
    --border: #000000;
  }

  body.dark {
    --bg: #000000;
    --fg: #ffffff;
    --card: #111111;
    --border: #ffffff;
  }

  * {
    box-sizing: border-box;
    font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
  }

  html, body {
    margin: 0;
    height: 100%;
    background: var(--bg);
    color: var(--fg);
    overflow: hidden;
    touch-action: none; /* critical for mobile */
  }

  /* THEME TOGGLER */
  .theme-toggle {
    position: absolute;
    top: 12px;
    right: 12px;
    width: 42px;
    height: 42px;
    border-radius: 12px;
    border: 1.5px solid var(--border);
    background: var(--bg);
    color: var(--fg);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    cursor: grab;
    user-select: none;
    z-index: 3000;
    touch-action: none;
  }

  /* CLOCK CONTAINER */
  .clock-widget {
    position: absolute;
    top: 90px;
    left: 20px;
    width: min(520px, 92vw);
    min-width: 280px;
    max-width: 92vw;
    padding: 20px;
    border-radius: 20px;
    border: 2px solid var(--border);
    background: var(--bg);
    cursor: grab;
    user-select: none;
    touch-action: none;
  }

  .clock-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 14px;
  }

  .time-box {
    aspect-ratio: 1 / 1.1;
    border-radius: 14px;
    border: 1px solid var(--border);
    background: var(--card);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .value {
    font-size: clamp(1.8rem, 5vw, 3rem);
    font-weight: 700;
    letter-spacing: 0.08em;
  }

  .label {
    margin-top: 6px;
    font-size: 0.65rem;
    opacity: 0.65;
    letter-spacing: 0.15em;
  }

  /* INVISIBLE RESIZE ZONES (BIGGER FOR TOUCH) */
  .resize-zone {
    position: absolute;
    width: 36px;
    height: 36px;
    z-index: 20;
  }

  .tl { top: 0; left: 0; }
  .tr { top: 0; right: 0; }
  .bl { bottom: 0; left: 0; }
  .br { bottom: 0; right: 0; }
</style>
</head>

<body class="dark">

<div class="theme-toggle" id="themeBtn">‚óê</div>

<div class="clock-widget" id="widget">
  <div class="resize-zone tl"></div>
  <div class="resize-zone tr"></div>
  <div class="resize-zone bl"></div>
  <div class="resize-zone br"></div>

  <div class="clock-grid">
    <div class="time-box"><div class="value" id="hh">--</div><div class="label">HOURS</div></div>
    <div class="time-box"><div class="value" id="mm">--</div><div class="label">MIN</div></div>
    <div class="time-box"><div class="value" id="ss">--</div><div class="label">SEC</div></div>
    <div class="time-box"><div class="value" id="ms">-</div><div class="label">0.1s</div></div>
  </div>
</div>

<script>
/* -------- CLOCK (100ms stable) -------- */
setInterval(() => {
  const d = new Date();
  hh.textContent = String(d.getHours()).padStart(2, "0");
  mm.textContent = String(d.getMinutes()).padStart(2, "0");
  ss.textContent = String(d.getSeconds()).padStart(2, "0");
  ms.textContent = Math.floor(d.getMilliseconds() / 100);
}, 100);

/* -------- THEME -------- */
themeBtn.onclick = () => document.body.classList.toggle("dark");

/* -------- DRAG (POINTER EVENTS) -------- */
function makeDraggable(el) {
  let ox = 0, oy = 0, dragging = false;

  el.addEventListener("pointerdown", e => {
    dragging = true;
    el.setPointerCapture(e.pointerId);
    ox = e.clientX - el.offsetLeft;
    oy = e.clientY - el.offsetTop;
  });

  el.addEventListener("pointermove", e => {
    if (!dragging) return;
    el.style.left = e.clientX - ox + "px";
    el.style.top = e.clientY - oy + "px";
  });

  el.addEventListener("pointerup", () => dragging = false);
}

makeDraggable(widget);
makeDraggable(themeBtn);

/* -------- RESIZE (MOBILE SAFE) -------- */
let resizeMode = null;
let startX, startW, startL;

document.querySelectorAll(".resize-zone").forEach(zone => {
  zone.addEventListener("pointerdown", e => {
    e.stopPropagation();
    resizeMode = zone.classList[1];
    startX = e.clientX;
    startW = widget.offsetWidth;
    startL = widget.offsetLeft;
  });
});

window.addEventListener("pointermove", e => {
  if (!resizeMode) return;

  const dx = e.clientX - startX;
  const minW = 280;
  const maxW = window.innerWidth * 0.95;

  if (resizeMode.includes("r")) {
    widget.style.width = Math.min(maxW, Math.max(minW, startW + dx)) + "px";
  }

  if (resizeMode.includes("l")) {
    const newW = Math.min(maxW, Math.max(minW, startW - dx));
    widget.style.width = newW + "px";
    widget.style.left = startL + dx + "px";
  }
});

window.addEventListener("pointerup", () => resizeMode = null);
</script>

</body>
</html>
